{% extends 'base.html' %}
{% load i18n %}
{% block title %}{% trans "Manage Matches" %}{% endblock %}

{% block content %}
<div class="container my-4">
    {# Page header #}
    <h2 class="h3 mb-3">{% trans "Manage Matches" %}</h2>

    {# Create New Match button #}
    <div class="mb-4">
        <a href="{% url 'matches:create_match' %}" class="btn btn-success btn-lg">
            <i class="bi bi-plus-circle me-2"></i> {% trans "Create New Match" %}
        </a>
    </div>

    {# Pagination buttons on top of the table #}
    <div class="d-flex justify-content-between mb-2">
        <button class="btn btn-primary" id="prev-btn" disabled>{% trans "Previous" %}</button>
        <button class="btn btn-primary" id="next-btn">{% trans "Next" %}</button>
    </div>

    {# Matches table #}
    <div class="table-responsive">
        <table class="table table-striped table-hover" id="matches-table">
            <thead class="table-dark">
                <tr>
                    <th>{% trans "Date" %}</th>
                    <th>{% trans "Day" %}</th>
                    <th>{% trans "Time" %}</th>
                    <th>{% trans "Location" %}</th>
                    <th>{% trans "Max Players" %}</th>
                    <th>{% trans "Spots Left" %}</th>
                    <th>{% trans "Actions" %}</th>
                </tr>
            </thead>
            <tbody>
                {% for match in matches %}
                <tr class="match-row">
                    <td data-label="Date">{{ match.date|date:"Y-m-d" }}</td>
                    <td data-label="Day">{% trans match.day_of_week|capfirst %}</td>
                    <td data-label="Time">{{ match.time|date:"H:i" }}</td>
                    <td data-label="Location">{{ match.location_name }}</td>
                    <td data-label="Max Players">{{ match.max_players }}</td>
                    <td data-label="Spots Left">{{ match.spots_left }}</td>
                    <td data-label="Actions">
                        {% if match.is_past %}
                            {# Past match: view only #}
                            <a href="{% url 'matches:view_match' match.id %}" class="btn btn-primary btn-sm mb-1">
                                <i class="bi bi-eye me-1"></i> {% trans "View" %}
                            </a>
                        {% else %}
                            {# Upcoming match: view / edit / delete #}
                            <a href="{% url 'matches:view_match' match.id %}" class="btn btn-primary btn-sm mb-1">
                                <i class="bi bi-eye me-1"></i> {% trans "View" %}
                            </a>
                            <a href="{% url 'matches:edit_match' match.id %}" class="btn btn-warning btn-sm mb-1">
                                <i class="bi bi-pencil-square me-1"></i> {% trans "Edit" %}
                            </a>
                            <a href="{% url 'matches:delete_match' match.id %}" class="btn btn-danger btn-sm mb-1">
                                <i class="bi bi-trash me-1"></i> {% trans "Delete" %}
                            </a>
                            {% if match.is_full %}
                                <button class="btn btn-secondary btn-sm mb-1" disabled>{% trans "Full" %}</button>
                            {% endif %}
                        {% endif %}
                    </td>
                </tr>
                {% empty %}
                <tr>
                    <td colspan="7" class="text-center">{% trans "No matches found." %}</td>
                </tr>
                {% endfor %}
            </tbody>

            {# Caption at the bottom explaining table behavior #}
            <caption class="text-muted">
                {% trans "Only 10 matches are shown at a time. Use the buttons above to see more." %}
            </caption>
        </table>
    </div>
</div>

{# JavaScript for client-side pagination of 10 matches per page #}
<script>
document.addEventListener("DOMContentLoaded", function() {
    const rows = document.querySelectorAll("#matches-table .match-row");
    const pageSize = 10;  // Show 10 matches per page
    let currentPage = 0;

    // Function to show the current page
    function showPage(page) {
        rows.forEach((row, index) => {
            row.style.display = (index >= page * pageSize && index < (page + 1) * pageSize) ? "" : "none";
        });

        // Disable/enable buttons based on current page
        document.getElementById("prev-btn").disabled = (page === 0);
        document.getElementById("next-btn").disabled = ((page + 1) * pageSize >= rows.length);
    }

    // Previous button click
    document.getElementById("prev-btn").addEventListener("click", () => {
        if (currentPage > 0) {
            currentPage--;
            showPage(currentPage);
        }
    });

    // Next button click
    document.getElementById("next-btn").addEventListener("click", () => {
        if ((currentPage + 1) * pageSize < rows.length) {
            currentPage++;
            showPage(currentPage);
        }
    });

    // Initialize first page
    showPage(currentPage);
});
</script>

{# Mobile styling for responsive table and buttons #}
<style>
    @media (max-width: 768px) {
        .table th, .table td { padding: 0.5rem 0.25rem; font-size: 0.9rem; }
        .btn-sm { font-size: 0.8rem; padding: 0.25rem 0.5rem; }
        .btn { display: block; width: 100%; margin-bottom: 0.25rem; }
        .btn:last-child { margin-bottom: 0; }
    }
    @media (max-width: 576px) {
        .btn-lg { width: 100%; padding: 0.75rem 1rem; }
        .table th, .table td { padding: 0.4rem 0.2rem; font-size: 0.85rem; }
    }
</style>
{% endblock %}
